<!DOCTYPE html>
<html class="fuelux" lang="en">
  <head>
    <meta charset="utf-8">
    <title>Beginning with some code</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href="http://fuelcdn.com/fuelux/2.2/css/fuelux.css" rel="stylesheet" /> 
	<link href="http://fuelcdn.com/fuelux/2.2/css/fuelux-responsive.css" rel="stylesheet" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
	<script src="http://fuelcdn.com/fuelux/2.2/loader.min.js" type="text/javascript"></script>
    <link href="/css/docs.css" rel="stylesheet">
    <link href="/js/google-code-prettify/prettify.css" rel="stylesheet">	
	<link rel="shortcut icon" href="/favicon.ico">    
  </head>
  <body data-spy="scroll" data-target=".subnav" data-offset="50">
	<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
	<div class="container">
	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	  </a>
	  <a class="brand" href="http://hyades.github.com">Aayush Ahuja</a>
	  <div class="nav-collapse">
		<ul class="nav">		  
		  <li class="">
			<a href="http://hyades.github.com"><i class="icon-home"></i> Home</a>
		  </li>
		  <li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-comment"></i> Social <b class="caret"></b></a>
				<ul class="dropdown-menu">										
					<li class=""><a href="http://www.twitter.com/aayushahuja" rel="tooltip" title="Go to twitter.com/eaayushahuja" target="_blank">Twitter</a></li>
					<li class=""><a href="http://github.com/hyades" rel="tooltip" title="Go to github.com/hyades" target="_blank">GitHub</a></li>
					
					<li class=""><a href="http://www.linkedin.com/in/aayushahuja" rel="tooltip" title="Go to LinkedIn profile" target="_blank">LinkedIn</a></li>
					<li class=""> <a href="https://plus.google.com/107146873396010795552?rel=author" rel="tooltip" title="Go to Google+ Page" target="_blank">Google</a></li>										
					
					<li class="divider"></li>
					<li class=""><a href="http://feeds.feedburner.com/github/hyades" rel="tooltip" title="Go to feedburner" target="_blank">RSS</a></li>
					
				</ul>
			 </li>
		<li class="dropdown">
			<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-list"></i> Projects <b class="caret"></b></a>
				<ul class="dropdown-menu">					
					<li class=""><a href="https://github.com/hyades/compiler" rel="tooltip" title="Go to compiler on GitHub" target="_blank">compiler</a></li>					
					<li class=""><a href="https://github.com/hyades/ex-opti" rel="tooltip" title="Go to EX-Opti on GitHub" target="_blank">Ex-Opti</a></li>
					<li class=""><a href="https://github.com/hyades/video" rel="tooltip" title="Go to Video on GitHub" target="_blank">Video</a></li>
					<li class=""><a href="https://github.com/hyades/file-hider" rel="tooltip" title="Go to File-Hider on GitHub" target="_blank">File Hider</a></li>			
					<li class=""><a href="https://github.com/hyades/dc-hacks" rel="tooltip" title="Go to DC-Hacks on GitHub" target="_blank">DC-Hacks</a></li>	
					<li class=""><a href="https://github.com/hyades/optimus-webwizard" rel="tooltip" title="Go to Optimus-Webwizard on GitHub" target="_blank">Optimus-Webwizard</a></li>	
					
				</ul>
			 </li>			
		</ul>		
	  </div>
	</div>
  </div>
</div>  
	<div class="container">	
		<div class="marketing">
		<div class="content">    
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'aayushahuja'; // required: replace example with your forum shortname
		var disqus_identifier = '/blog/Beginning-with-some-code';
		var disqus_url = 'http://hyades.github.com/blog/Beginning-with-some-code';

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function () {
			var s = document.createElement('script'); s.async = true;
			s.type = 'text/javascript';
			s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
			(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
		}());
	</script>
	
<div class="row">	
	<div class="span9 column">
		<p><h1>Beginning with some code</h1></p>	
	</div>
</div>		
<div class="row">	
	<div class="span3 column">
		<h5><strong>June  7, 2013 <small>.  . <a href="http://hyades.github.com/blog/Beginning-with-some-code#disqus_thread" data-disqus-identifier="/blog/Beginning-with-some-code">Comments</a></small></strong>
		<br/><small>Tags:  <a href="/tags/gsoc" title="View posts tagged with &quot;gsoc&quot;"><u>gsoc</u></a>     <a href="/tags/timvideos" title="View posts tagged with &quot;timvideos&quot;"><u>timvideos</u></a>     <a href="/tags/python" title="View posts tagged with &quot;python&quot;"><u>python</u></a>    </small><br/><br/>
		<a href="https://twitter.com/share" class="twitter-share-button" data-via="aayushahuja">Tweet</a> <g:plusone size="medium"></g:plusone></h5>
	</div>		
	<div class="span6 column">
		<p class="pull-right"> <a href="/blog/Experiments-with-dbus" title="Previous Post: Experiments with dbus"><i class="icon-chevron-left"></i></a> 	    	<a href="/blog/The-SoC-coding-period-starts-off" title="Next Post: The SoC Coding Period Starts Off"><i class="icon-chevron-right"></i></a> 	 </p>  
	</div>	
</div>
<div class="row">
	<div class="span9 column">
		<hr>
	</div>
</div>


    <p>
    Finally getting some fingers moving. I am pushing code at <a href="https://github.com/hyades/gst-switch/tree/python-api">here</a>. Worked out an initial class structure for getting the things working. I am trying to put in little bit of documentation in the function itself.
    <br>
    Currently there are three main classes: Server, UI and Controller.
</p>


<h4>
    The Server
</h4>


<p>
    The Server is the interaction module with gst-switch-srv. It is capable of controlling the server. The Server class has a contructor where the user can specify the video port, audio port, control port and the output record file.
    
<div class="highlight"><pre><code class="python">       <span class="kn">from</span> <span class="nn">gstswitch</span> <span class="kn">import</span> <span class="o">*</span>      <span class="c">#importing all modules</span>
    
</code></pre></div>

    
<div class="highlight"><pre><code class="python">       <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">()</span>           <span class="c">#simple enough thing, gets the server running with default parameters.</span>
    
</code></pre></div>

    The server can be started off forking a new process and can safely be killed. Connection to the controller can be made by invoking the Controller class.
    
<div class="highlight"><pre><code class="python">       <span class="n">control</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">connectController</span><span class="p">()</span>
    
</code></pre></div>

    If a connection does not exist a new connection should be made to the Controller. Now that the server is running, there should be some input to the server! These are the videotestsrc elements of gstreamer. I have added options where the user can select what pattern, height, width etc can be specified. The width of the input stream should be 300 and height should be 200 always, else it might result in some strange unclear patterns coming up. If no pattern is specified a random one gets selected.
    
<div class="highlight"><pre><code class="python">       <span class="n">server</span><span class="o">.</span><span class="n">newTestVideo</span><span class="p">()</span>       <span class="c">#adds a new test source to the gst-switch</span>
        <span class="n">server</span><span class="o">.</span><span class="n">getAllTestVideo</span><span class="p">()</span>    <span class="c">#displays all test sources feeding in the gst-switch</span>
    
</code></pre></div>

    The Server and the test sources can be easily killed off by invoking like this. I was earlier facing a problem where the subprocess.Popen() command was making two processes. Now, while killing only one gets killed, whereas the other one was still remaining. I was using an option shell=True as an argument to the Popen command. Changing this option to shell=False allowed me to control the server class more easily as in this case only one process gets created!
    
<div class="highlight"><pre><code class="python">       <span class="n">server</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>                <span class="c">#kills off the server process</span>
        <span class="n">server</span><span class="o">.</span><span class="n">endAllTestVideo</span><span class="p">()</span>    <span class="c">#kills off all test videos that have been defined. server.end() takes care of this</span>
    
</code></pre></div>

    Currently the video sources are being fed by creating new processes. I will modify these using the Gstreamer 1.0 Python Bindings defined under gi.repository.Gst
</p>


<h4>
    The UI
</h4>


<p>
    Now the server is running and the input sources have been specified, we need to view the output that is getting generated. For this the gst-switch-ui can be invoked. Simply the UI is run using:
    
<div class="highlight"><pre><code class="python">       <span class="n">ui</span> <span class="o">=</span> <span class="n">UI</span><span class="p">()</span>
    
</code></pre></div>

    The UI process is ended simply using ui.end() method.
    Once the controller is ready, the compose port can be used to view the output of the gst-switch server directly eliminating the need of the UI.
</p>




<div class="row">   
    <div class="span9 column">
            <p class="pull-right"> <a href="/blog/Experiments-with-dbus" title="Previous Post: Experiments with dbus"><i class="icon-chevron-left"></i></a>             <a href="/blog/The-SoC-coding-period-starts-off" title="Next Post: The SoC Coding Period Starts Off"><i class="icon-chevron-right"></i></a>      </p>  
    </div>

</div>




<div class="row">   
    <div class="span9 columns">    
        <h2>Comments Section</h2>
        <p>Feel free to comment on the post but keep it clean and on topic.</p> 
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'aayushahuja'; // required: replace example with your forum shortname
            
            
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
</div>




<!-- Twitter -->


<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>




<!-- Google + -->


<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>


<!-- Written by hyades -->



		
</div>
    

		</div>		 
	 </div>   
	<footer class="footer">
  <div class="container">
	<p class="pull-right"> <a href="/blog/Experiments-with-dbus" title="Previous Post: Experiments with dbus">&laquo; Previous Blog Post</a> 	  |  <a href="#">Back to top</a>  |   	<a href="/blog/The-SoC-coding-period-starts-off" title="Next Post: The SoC Coding Period Starts Off">Next Blog Post &raquo; </a> 	 </p>        
	<p>Page last generated on July 15, 2013</p>
	<p>If need be, <a href="https://github.com/hyades/Feedback/issues/new" title="Leave feedback for Aayush"  target="_blank" >Give feedback here</a>.</p>	
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>	
	
	
 </div>

</footer>
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>    
    
	<script src="/js/custom.js" type="text/javascript"></script>	
	
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'aayushahuja'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function () {
			var s = document.createElement('script'); s.async = true;
			s.type = 'text/javascript';
			s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
			(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
		}());
	</script>
	
	<!-- Google Analytics -->
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41289176-1', 'github.com');
  ga('send', 'pageview');

	</script>
  </body>
</html>
